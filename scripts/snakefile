TARGETS, = glob_wildcards("/data/fasta/{name}")

rule all:
 input: 
  "/data/matrix_results/domain_content.matrix",
  "/data/matrix_results/domain_duplication_mode.matrix",
  "/data/matrix_results/domain_abundance.matrix",
  "/data/matrix_results/domain_versatility.matrix"

rule pfamscan:
 input:
  fa = "/data/fasta/{target}",
  pfam_db = "/data/pfam_database/"

 output:
  "/data/pfamscan_results/{target}.pfamscan"

 shell:
  "pfam_scan.pl -fasta {input.fa} -dir {input.pfam_db} -outfile {output} -e_seq 1e-5 -e_dom 1e-5"


rule domain_content_matrix:
 input:
  pf_out = expand("/data/pfamscan_results/{target}.pfamscan", target=TARGETS),
  pf_out_dir="/data/pfamscan_results/"
 output:
  "/data/matrix_results/domain_content.matrix"
 shell:
  "calculate_species_level_domain_content_matrix.py {input.pf_out_dir} {output}"


rule domain_duplication_matrix:
 input:
  pf_out = expand("/data/pfamscan_results/{target}.pfamscan", target=TARGETS),
  pf_out_dir="/data/pfamscan_results/"
 output:
  "/data/matrix_results/domain_duplication_mode.matrix"
 shell:
  "calculate_species_level_domain_duplication_matrix.py {input.pf_out_dir} {output}"

rule domain_abundance_matrix:
 input:
  pf_out = expand("/data/pfamscan_results/{target}.pfamscan", target=TARGETS),
  pf_out_dir="/data/pfamscan_results/"

 output:
  "/data/matrix_results/domain_abundance.matrix"
 shell:
  "calculate_species_level_domain_abundance_matrix.py {input.pf_out_dir} {output}"

rule domain_versatility_matrix:
 input:
  pf_out = expand("/data/pfamscan_results/{target}.pfamscan", target=TARGETS),
  pf_out_dir="/data/pfamscan_results/"

 output:
  "/data/matrix_results/domain_versatility.matrix"
 shell:
  "calculate_species_level_domain_versatility_matrix.py {input.pf_out_dir} {output}"
